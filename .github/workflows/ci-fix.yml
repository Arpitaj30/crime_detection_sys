name: Apply CI Bot Fix

on:
  issue_comment:
    types: [created]

jobs:
  apply-fix:
    if: github.event.comment.body == '/fix'
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.10"

      - name: Install bot client deps
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: Trigger fix on AI CI Bot
        env:
          BOT_SERVER_URL: ${{ secrets.BOT_SERVER_URL }}
        run: |
          curl -X POST $BOT_SERVER_URL/apply-fix \
          -H "Content-Type: application/json" \
          -d '{
            "repo": "'"${{ github.repository }}"'",
            "pr_number": "'"${{ github.event.issue.number }}"'"
          }'
